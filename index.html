
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thermofluid Flow over External Magnetic Field (B)</title>
  <style>
    :root { --bg:#0b0b0f; --fg:#e8e8ea; --muted:#9aa0a6; }
    * { box-sizing: border-box; }
    body { margin:0; background:var(--bg); color:var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; }
    .wrap { max-width:1100px; margin:24px auto; padding:16px; }
    h1 { font-size:18px; font-weight:600; margin:0 0 10px 0; }
    .panel { display:flex; gap:16px; align-items:center; flex-wrap:wrap; margin-bottom:10px; }
    .panel label { font-size:14px; color:var(--muted); }
    .panel input[type="range"] { width:260px; }
    .stage { position:relative; background:#fff; border-radius:10px; box-shadow: 0 6px 30px rgba(0,0,0,.25); padding:18px 18px 12px 56px; }
    canvas { display:block; width:100%; height:auto; border-radius:8px; }
    .axis-label { position:absolute; left:6px; top:50%; transform: translateY(-50%) rotate(-90deg); transform-origin:left top; font-size:14px; color:#111; }
    .b-badge { position:absolute; left:14px; top:14px; background:#111; color:#fff; padding:4px 8px; border-radius:6px; font-weight:600; font-size:12px; letter-spacing:.2px; }
    .legend { display:flex; gap:6px; align-items:center; margin-top:8px; font-size:12px; color:var(--muted); }
    .chip { width:26px; height:10px; border-radius:3px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Thermofluid stream over an externally applied magnetic field</h1>
    <div class="panel">
      <label>Magnetic field strength B (Gauss): <b id="bVal">1200</b></label>
      <input id="bSlider" type="range" min="0" max="2000" step="10" value="1200" />
      <label>Streamlines: <b id="nSeeds">80</b></label>
      <input id="seedSlider" type="range" min="20" max="160" step="5" value="80" />
      <label>Vectors</label>
      <input id="vecToggle" type="checkbox" checked />
    </div>

    <div class="stage">
      <div class="axis-label">y / H</div>
      <div class="b-badge" id="bBadge">B = 1200 G</div>
      <canvas id="cv" width="1000" height="260" aria-label="flow field"></canvas>
      <div class="legend">
        <span class="chip" style="background:#1f4fff"></span>
        <span>low | |</span>
        <span class="chip" style="background:#39b54a"></span>
        <span>| |</span>
        <span class="chip" style="background:#ffe23a"></span>
        <span>high velocity magnitude</span>
      </div>
    </div>
    <p style="color:var(--muted);font-size:12px;margin-top:8px;">Domain: 0 ≤ x/H ≤ 10, 0 ≤ y/H ≤ 1 (aspect preserved). Colors show |V|. Black arrows show local velocity direction. Blue bars indicate the external magnet poles and the red insert marks the energized core. This is a qualitative visual model (not CFD).</p>
  </div>

  <script>
    // Canvas mapping & parameters
    const cv = document.getElementById('cv');
    const ctx = cv.getContext('2d');
    const PAD_L = 8, PAD_R = 8, PAD_T = 8, PAD_B = 24;
    const W = cv.width - PAD_L - PAD_R;
    const H = cv.height - PAD_T - PAD_B;

    function XtoPx(x){ return PAD_L + x/10 * W; }
    function YtoPx(y){ return PAD_T + (1-y) * H; }

    // Controls
    const bSlider = document.getElementById('bSlider');
    const seedSlider = document.getElementById('seedSlider');
    const vecToggle = document.getElementById('vecToggle');
    const bVal = document.getElementById('bVal');
    const nSeedsEl = document.getElementById('nSeeds');
    const bBadge = document.getElementById('bBadge');

    // Parameters
    let B = +bSlider.value;
    let nSeeds = +seedSlider.value;
    const U0 = 1.0;
    const xm = 5.0, ym = 0.35;
    const sx = 0.9, sy = 0.25;
    const recircX = 5.0, recircY = 0.12;
    const recSx = 0.7, recSy = 0.10;

    // Colormap
    function colormapBlueGreenYellow(t){
      t = Math.max(0, Math.min(1, t));
      let r,g,b;
      if(t < 0.5){
        const u = t/0.5;
        r = (0.22-0.12)*u + 0.12;
        g = (0.71-0.47)*u + 0.47;
        b = (0.29-0.95)*u + 0.95;
      } else {
        const u = (t-0.5)/0.5;
        r = (1.00-0.22)*u + 0.22;
        g = (0.89-0.71)*u + 0.71;
        b = (0.23-0.29)*u + 0.29;
      }
      return `rgb(${Math.round(r*255)},${Math.round(g*255)},${Math.round(b*255)})`;
    }

    // Velocity field
    function velocity(x,y,t){
      const u_base = U0 * (1 - Math.pow(y-0.5,2)) * 1.25 + 0.02*Math.sin(6.0*(y+0.1)+0.7*t);
      let v_base = 0.00;
      const bNorm = B/1200;
      const gx = Math.exp(- ( (x-xm)*(x-xm)/(2*sx*sx) + (y-ym)*(y-ym)/(2*sy*sy) ));
      const u_mag = 0.65*bNorm*gx;
      const v_mag = 1.50*bNorm*(y-ym)*gx;
      const g2 = Math.exp(- ( (x-recircX)*(x-recircX)/(2*recSx*recSx) + (y-recircY)*(y-recircY)/(2*recSy*recSy) ));
      const str = 1.2*bNorm;
      const u_eddy =  str * (-(y-recircY)) * g2;
      const v_eddy =  str * ( (x-recircX)) * g2;
      const wall = Math.max(0, 1 - 18*Math.min(y, 1-y));
      const u = (u_base + u_mag + u_eddy) * (1 - 0.0*wall);
      const v = (v_base + v_mag + v_eddy) * (1 - wall);
      return {u, v};
    }

    // Axes & Magnets
    function drawAxes(){
      ctx.save();
      ctx.strokeStyle = '#111';
      ctx.lineWidth = 1; ctx.beginPath();
      ctx.rect(PAD_L, PAD_T, W, H);
      ctx.stroke();
      ctx.fillStyle = '#111'; ctx.font = '12px system-ui';
      for(let i=0;i<=10;i++){
        const xp = XtoPx(i);
        ctx.beginPath(); ctx.moveTo(xp, PAD_T+H); ctx.lineTo(xp, PAD_T+H+5); ctx.stroke();
        ctx.fillText(i.toString(), xp-3, PAD_T+H+18);
      }
      ctx.fillText('x / H', XtoPx(9.3), PAD_T+H+18);
      for(let j=0;j<=10;j++){
        const y = j/10; const yp = YtoPx(y);
        ctx.beginPath(); ctx.moveTo(PAD_L-5, yp); ctx.lineTo(PAD_L, yp); ctx.stroke();
        if(j%2===0) ctx.fillText((y).toString().replace(/^0\./,'.'), 2, yp+4);
      }
      ctx.restore();
    }

    function drawMagnets(){
      const barW = 16, barH = 22; const cx = XtoPx(5);
      ctx.fillStyle = '#1f4fff';
      ctx.fillRect(cx - barW/2, PAD_T - barH - 8, barW, barH);
      ctx.fillRect(cx - barW/2, PAD_T + H + 8, barW, barH);
      const rx = XtoPx(4); ctx.fillStyle = '#e6312b';
      ctx.fillRect(rx - 8, PAD_T + H + 2, 16, 16);
    }

    // Colormap field
    function drawColormap(t){
      const img = ctx.createImageData(W, H);
      let p = 0; const tmp = document.createElement('canvas').getContext('2d');
      for(let j=0;j<H;j++){
        const y = 1 - (j+0.5)/H;
        for(let i=0;i<W;i++){
          const x = (i+0.5)/W * 10;
          const {u,v} = velocity(x,y,t);
          const mag = Math.sqrt(u*u+v*v);
          const tval = Math.min(1, Math.max(0, (mag - 0.2)/1.4));
          tmp.fillStyle = colormapBlueGreenYellow(tval);
          tmp.fillRect(0,0,1,1);
          const rgb = tmp.getImageData(0,0,1,1).data;
          img.data[p++] = rgb[0]; img.data[p++] = rgb[1]; img.data[p++] = rgb[2]; img.data[p++] = 255;
        }
      }
      ctx.putImageData(img, PAD_L, PAD_T);
    }

    // Vectors
    function drawVectors(t){
      ctx.strokeStyle = '#111'; ctx.lineWidth = 1;
      const stepX = 0.4, stepY = 0.1;
      for(let y=0.05; y<=0.95; y+=stepY){
        for(let x=0.2; x<=9.8; x+=stepX){
          const {u,v} = velocity(x,y,t);
          const x1 = XtoPx(x); const y1 = YtoPx(y);
          const x2 = XtoPx(x + 0.05*u); const y2 = YtoPx(y + 0.05*v);
          ctx.beginPath(); ctx.moveTo(x1,y1); ctx.lineTo(x2,y2); ctx.stroke();
          const ang = Math.atan2(y2-y1, x2-x1); const ah = 4;
          ctx.beginPath();
          ctx.moveTo(x2,y2);
          ctx.lineTo(x2 - ah*Math.cos(ang - Math.PI/6), y2 - ah*Math.sin(ang - Math.PI/6));
          ctx.lineTo(x2 - ah*Math.cos(ang + Math.PI/6), y2 - ah*Math.sin(ang + Math.PI/6));
          ctx.closePath(); ctx.fillStyle = '#111'; ctx.fill();
        }
      }
    }

    // Streamlines
    const particles = [];
    function resetParticles(){
      particles.length = 0;
      for(let i=0;i<nSeeds;i++){
        const y = (i+0.5)/nSeeds * 0.9 + 0.05;
        particles.push({ x: 0.02, y, life: 10+Math.random()*2 });
      }
    }

    function stepParticles(dt, t){
      for(const p of particles){
        let {u,v} = velocity(p.x, p.y, t);
        const xmid = p.x + 0.5*u*dt; const ymid = p.y + 0.5*v*dt;
        const k2 = velocity(xmid, ymid, t+0.5*dt);
        p.x += k2.u*dt; p.y += k2.v*dt; p.life -= dt;
        if(p.x > 10 || p.y<0 || p.y>1 || p.life<=0){
          p.x = 0.02; p.y = 0.05 + 0.90*Math.random(); p.life = 10+Math.random()*2;
        }
      }
    }

    function drawParticles(){
      ctx.save(); ctx.globalAlpha = 0.85; ctx.strokeStyle = '#000';
      for(const p of particles){
        ctx.beginPath(); ctx.arc(XtoPx(p.x), YtoPx(p.y), 0.8, 0, Math.PI*2); ctx.stroke();
      }
      ctx.restore();
    }

    // Animation
    let last = 0;
    function frame(ts){
      if(!last) last = ts; const dtms = ts - last; last = ts;
      const t = ts*0.001;
      drawColormap(t); drawAxes(); if(vecToggle.checked) drawVectors(t); drawMagnets();
      stepParticles(0.35 * (dtms/1000), t); drawParticles();
      bBadge.textContent = `B = ${B.toFixed(0)} G`;
      requestAnimationFrame(frame);
    }

    // Events
    bSlider.addEventListener('input', e=>{ B = +e.target.value; bVal.textContent = B; });
    seedSlider.addEventListener('input', e=>{ nSeeds = +e.target.value; nSeedsEl.textContent = nSeeds; resetParticles(); });

    resetParticles(); requestAnimationFrame(frame);
  </script>
</body>
</html>
